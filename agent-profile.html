<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Profile - AgentScore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563eb',
                        secondary: '#1e40af',
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <span class="text-2xl font-bold text-primary">Agent</span>
                        <span class="text-2xl font-bold text-gray-800">Score</span>
                    </a>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="agents.html" class="text-gray-600 hover:text-primary transition">Browse Agents</a>
                    <a href="index.html#cities" class="text-gray-600 hover:text-primary transition">Cities</a>
                    <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition">
                        Write Review
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <nav class="flex text-sm text-gray-500">
                <a href="index.html" class="hover:text-primary">Home</a>
                <span class="mx-2">‚Üí</span>
                <a href="agents.html" class="hover:text-primary">Agents</a>
                <span class="mx-2">‚Üí</span>
                <span id="breadcrumb-city" class="hover:text-primary cursor-pointer">City</span>
                <span class="mx-2">‚Üí</span>
                <span id="breadcrumb-name" class="text-gray-800">Agency Name</span>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Main Column -->
            <div class="flex-1">
                <!-- Agency Header Card -->
                <div class="bg-white rounded-xl shadow-sm p-6 lg:p-8">
                    <div class="flex flex-col md:flex-row md:items-start gap-6">
                        <!-- Logo -->
                        <div id="agent-logo" class="w-20 h-20 bg-primary/10 rounded-xl flex items-center justify-center text-primary font-bold text-3xl flex-shrink-0">
                            A
                        </div>
                        
                        <!-- Info -->
                        <div class="flex-1">
                            <h1 id="agent-name" class="text-2xl lg:text-3xl font-bold text-gray-800">Loading...</h1>
                            <p id="agent-location" class="text-gray-500 flex items-center gap-2 mt-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>Location</span>
                            </p>
                            
                            <!-- Rating -->
                            <div class="flex items-center gap-4 mt-4">
                                <div class="flex items-center gap-2">
                                    <span id="agent-rating" class="text-4xl font-bold text-gray-800">0.0</span>
                                    <div>
                                        <div id="agent-stars" class="flex items-center"></div>
                                        <p id="agent-review-count" class="text-sm text-gray-500">0 reviews</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Tags -->
                            <div id="agent-tags" class="flex flex-wrap gap-2 mt-4">
                                <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">üè† Sales</span>
                                <span class="bg-green-50 text-green-700 px-3 py-1 rounded-full text-sm">üîë Rentals</span>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex flex-col gap-3 md:ml-auto">
                            <a id="agent-website" href="#" target="_blank" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition text-center font-medium">
                                Visit Website
                            </a>
                            <button class="border border-primary text-primary px-6 py-3 rounded-lg hover:bg-primary/5 transition font-medium">
                                Write Review
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="mt-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Reviews</h2>
                        <select id="review-sort" class="px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <option value="recent">Most Recent</option>
                            <option value="highest">Highest Rated</option>
                            <option value="lowest">Lowest Rated</option>
                        </select>
                    </div>

                    <div id="reviews-list" class="space-y-4">
                        <!-- Reviews will be loaded by JS -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <p class="text-gray-500 text-center py-8">Loading reviews...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="lg:w-80 flex-shrink-0">
                <!-- Contact Card -->
                <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24">
                    <h3 class="font-semibold text-gray-800 mb-4">Contact Information</h3>
                    
                    <div class="space-y-4">
                        <div id="contact-website" class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                            </svg>
                            <div>
                                <p class="text-sm text-gray-500">Website</p>
                                <a id="sidebar-website" href="#" target="_blank" class="text-primary hover:underline break-all">Loading...</a>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            <div>
                                <p class="text-sm text-gray-500">Active Listings</p>
                                <p id="sidebar-listings" class="text-gray-800 font-medium">0</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <div>
                                <p class="text-sm text-gray-500">Location</p>
                                <p id="sidebar-location" class="text-gray-800 font-medium">Cyprus</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rating Breakdown -->
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="font-medium text-gray-800 mb-4">Rating Breakdown</h4>
                        <div id="rating-breakdown" class="space-y-2">
                            <!-- Rating bars will be loaded by JS -->
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex items-center justify-center mb-4">
                <span class="text-xl font-bold text-white">Agent</span>
                <span class="text-xl font-bold text-primary">Score</span>
            </div>
            <p class="text-sm">¬© 2025 AgentScore. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script>
        let currentAgent = null;
        let agentReviews = [];

        document.addEventListener('DOMContentLoaded', async function() {
            const params = new URLSearchParams(window.location.search);
            const agentId = params.get('id');

            if (!agentId) {
                window.location.href = 'agents.html';
                return;
            }

            const agents = await loadAgentData();
            currentAgent = agents.find(a => a.name === agentId);

            if (!currentAgent) {
                window.location.href = 'agents.html';
                return;
            }

            // Update page title
            document.title = `${currentAgent.name} - AgentScore`;

            // Update breadcrumb
            document.getElementById('breadcrumb-name').textContent = currentAgent.name;
            document.getElementById('breadcrumb-city').textContent = currentAgent.location;
            document.getElementById('breadcrumb-city').onclick = () => {
                window.location.href = `agents.html?city=${currentAgent.location}`;
            };

            // Update header
            document.getElementById('agent-logo').textContent = currentAgent.name.charAt(0).toUpperCase();
            document.getElementById('agent-name').textContent = currentAgent.name;
            document.getElementById('agent-location').querySelector('span').textContent = currentAgent.location + ', Cyprus';
            document.getElementById('agent-rating').textContent = currentAgent.rating.toFixed(1);
            document.getElementById('agent-stars').innerHTML = renderStars(currentAgent.rating);
            document.getElementById('agent-review-count').textContent = `Based on ${currentAgent.reviewCount} reviews`;

            // Website
            document.getElementById('agent-website').href = currentAgent.url;
            document.getElementById('sidebar-website').href = currentAgent.url;
            document.getElementById('sidebar-website').textContent = new URL(currentAgent.url).hostname;

            // Sidebar
            document.getElementById('sidebar-listings').textContent = currentAgent.ads + ' active listings';
            document.getElementById('sidebar-location').textContent = currentAgent.location + ', Cyprus';

            // Generate mock reviews
            agentReviews = generateMockReviews(currentAgent);
            
            // Render rating breakdown
            renderRatingBreakdown(agentReviews);
            
            // Render reviews
            renderReviews(agentReviews);

            // Sort handler
            document.getElementById('review-sort').addEventListener('change', function() {
                const sorted = [...agentReviews];
                switch (this.value) {
                    case 'recent':
                        sorted.sort((a, b) => new Date(b.date) - new Date(a.date));
                        break;
                    case 'highest':
                        sorted.sort((a, b) => b.rating - a.rating);
                        break;
                    case 'lowest':
                        sorted.sort((a, b) => a.rating - b.rating);
                        break;
                }
                renderReviews(sorted);
            });
        });

        function generateMockReviews(agent) {
            const reviewerNames = [
                'Maria K.', 'Andreas P.', 'Elena S.', 'Yuri M.', 'Rosa B.',
                'Michael T.', 'Sophie L.', 'Nikos A.', 'Anna C.', 'George D.',
                'Olga V.', 'Dimitris M.', 'Christina P.', 'Pavel R.', 'Sarah W.'
            ];
            
            const reviewTexts = [
                "Excellent service! Very professional and helped us find the perfect property.",
                "Great experience working with this agency. Highly recommended!",
                "Professional team, quick responses, and transparent throughout the process.",
                "Found our dream home thanks to their expertise. Very satisfied!",
                "Good communication and attention to detail. Would use again.",
                "Knowledgeable about the local market. Helped negotiate a great deal.",
                "Responsive and helpful throughout our property search.",
                "Made the buying process smooth and stress-free. Thank you!",
                "Professional service from start to finish. Very happy with the result.",
                "Trustworthy agency with experienced staff. Recommended!"
            ];

            const count = Math.min(agent.reviewCount, 10); // Show max 10 mock reviews
            const reviews = [];
            
            for (let i = 0; i < count; i++) {
                const rating = generateRatingForAverage(agent.rating);
                const daysAgo = Math.floor(Math.random() * 365);
                const date = new Date();
                date.setDate(date.getDate() - daysAgo);
                
                reviews.push({
                    id: i + 1,
                    reviewer: reviewerNames[Math.floor(Math.random() * reviewerNames.length)],
                    rating: rating,
                    date: date.toISOString().split('T')[0],
                    text: reviewTexts[Math.floor(Math.random() * reviewTexts.length)],
                    source: Math.random() > 0.5 ? 'Google' : 'User'
                });
            }

            return reviews.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function generateRatingForAverage(targetAvg) {
            // Generate ratings that roughly average to target
            const variance = Math.random() * 2 - 1; // -1 to 1
            let rating = targetAvg + variance;
            rating = Math.max(1, Math.min(5, Math.round(rating)));
            return rating;
        }

        function renderRatingBreakdown(reviews) {
            const container = document.getElementById('rating-breakdown');
            const counts = [0, 0, 0, 0, 0];
            
            reviews.forEach(r => counts[r.rating - 1]++);
            const total = reviews.length || 1;

            let html = '';
            for (let i = 5; i >= 1; i--) {
                const count = counts[i - 1];
                const percent = (count / total) * 100;
                html += `
                    <div class="flex items-center gap-2 text-sm">
                        <span class="w-3">${i}</span>
                        <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div class="bg-yellow-400 h-2 rounded-full" style="width: ${percent}%"></div>
                        </div>
                        <span class="w-8 text-gray-500 text-right">${count}</span>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function renderReviews(reviews) {
            const container = document.getElementById('reviews-list');
            
            if (reviews.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-xl p-8 shadow-sm text-center">
                        <p class="text-gray-500">No reviews yet. Be the first to review!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = reviews.map(review => `
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 font-medium">
                                ${review.reviewer.charAt(0)}
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${review.reviewer}</p>
                                <p class="text-sm text-gray-500">${formatDate(review.date)}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-1">
                            ${renderStars(review.rating)}
                        </div>
                    </div>
                    <p class="text-gray-600">${review.text}</p>
                    <div class="mt-3 flex items-center gap-2">
                        <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">
                            via ${review.source}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
            return `${Math.floor(diffDays / 365)} years ago`;
        }
    </script>
</body>
</html>
